function Facebook(){function e(e){Ti.API.info("fireRequest"),i.open("GET","https://graph.facebook.com/me?access_token="+e),Ti.API.info("open parameters"),i.send()}var t=Titanium.UI.createWindow({backgroundColor:"white",exitOnClose:!1,layout:"vertical",orientationModes:[Titanium.UI.PORTRAIT]}),i=Titanium.Network.createHTTPClient({onload:function(){var e=JSON.parse(this.responseText);Ti.App.Properties.setString("first_name",e.first_name),Ti.App.Properties.setString("last_name",e.last_name),Ti.App.Properties.setString("mail",e.email),Ti.App.Properties.setString("id",e.id),Ti.App.Properties.setString("login_type","facebook"),Ti.App.Properties.setString("picture","http://graph.facebook.com/"+e.id+"/picture?width=500&height=500"),Ti.API.info(e.email+","+e.last_name+","+e.first_name),Titanium.Network.removeAllHTTPCookies(),Titanium.Network.removeAllSystemCookies(),saveHer.stopExecution=!1,Ti.App.fireEvent("goto_page",{page:2}),t.close()},onerror:function(){a.setMessage("C'è stato un errore nell'invio della richiesta. Ti preghiamo di riprovare più tardi!"),a.show(),t.close(),saveHer.stopExecution=!1}}),n=Ti.UI.createWebView({url:"https://www.facebook.com/dialog/oauth?client_id=565787606817344&redirect_uri=https://www.facebook.com/connect/login_success.html&response_type=token&scope=email",width:"100%",height:"100%",top:0,left:0,cacheMode:Titanium.UI.Android.WEBVIEW_LOAD_NO_CACHE});return n.addEventListener("load",function(t){if(Ti.API.info("webview loaded: "+t.url),-1!=t.url.indexOf("access_token")){var i=t.url.split("=");Ti.API.info(i[1]),e(i[1])}}),t.openWin=function(){t.open()},t.add(n),t.addEventListener("androidback",function(){Ti.App.fireEvent("login_closed",{what:"facebook"}),t.close()}),t}module.exports=Facebook;