function Report(){var e=require("ui/gtablet/external/Listeners"),t=new e,i=require("external/Location"),n=require("ui/gtablet/rectangles/ReportRectangle"),a=new n,r=require("ui/gtablet/rectangles/NetworkRectangle"),o=new r,s=require("ui/gtablet/rectangles/GPSRectangle"),l=new s,u=require("ui/gtablet/ui_elements/Buttons"),c=require("ui/gtablet/pages/MainPage"),d=new i,f=!1,h=Titanium.UI.createWindow({backgroundColor:"#eeeeee",width:"100%",height:"100%",title:"Report",windowSoftInputMode:Titanium.UI.Android.SOFT_INPUT_STATE_ALWAYS_HIDDEN,orientationModes:[Titanium.UI.PORTRAIT]});h.activity.onCreateOptionsMenu=function(){h.activity.actionBar},h.addEventListener("androidback",function(){Ti.App.fireEvent("restore_icon",{}),d.removeGPSEvent();var e=Titanium.Android.currentActivity;e.finish();var t=new c;t.open(),h.close()}),o.addEventListener("click",function(){"Fatto!"!=o.getButtonStatus()&&t.storeReport(o,a,d,l,h)});var p=Titanium.UI.createView({width:"90%",height:Ti.UI.SIZE,backgroundColor:"#f6f6f6",layout:"vertical"}),m=Titanium.UI.createView({width:"100%",height:3,backgroundColor:"#DBDBDB"}),g=Titanium.UI.createLabel({text:"Report",font:{fontSize:60,fontFamily:"CaviarDreams"},color:"#4F5153",top:10}),T=Titanium.UI.createLabel({text:"Crea una nuova segnalazione.",font:{fontSize:26,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:25,width:"95%"}),_=Titanium.UI.createLabel({text:"Se sei in condizioni di scarsa rete, puoi memorizzare la segnalazione effettuando un tap sulla tile sottostante.",font:{fontSize:24,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:35,width:"90%"}),v=Titanium.UI.createLabel({text:"Se sei stanco di attendere il segnale GPS, specifica le tue coordinate manualmente tappando sulla tile qui sotto.",font:{fontSize:24,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:35,width:"90%"}),y=new u;y.setButtonTitle("Invia"),y.setButtonTop(40),y.addEventListener("click",function(){if("Inviato!"!=y.getButtonTitle()&&!saveHer.stopExecution){if(saveHer.stopExecution=!0,a.areImagesEmpty()){{Ti.UI.createAlertDialog({message:"Per inviare un report, per favore inserisci almeno una foto.",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void y.setButtonTitle("Invia")}if(!d.hasGPSDone){{Ti.UI.createAlertDialog({message:"Prima di inviare il report, attendi che le coordinate vengano acquisite!",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void y.setButtonTitle("Invia")}if(!Ti.Network.getOnline()){{Ti.UI.createAlertDialog({message:"Per inviare un report, connetti il tuo dispositivo ad una rete!",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void y.setButtonTitle("Invia")}if(!Titanium.Filesystem.isExternalStoragePresent()){{Ti.UI.createAlertDialog({message:"Ãˆ necessaria una memoria esterna di appoggio per processare i dati prima dell'invio, ma il tuo disposito non sembra esserne munito.",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void y.setButtonTitle("Invia")}t.sendReport(y,a,l)}});var S=Titanium.UI.createView({width:1,height:20,backgroundColor:"transparent"});return Ti.App.addEventListener("web_map_pin",function(e){l.setLatLng(e.coords.k,e.coords.B),d.removeGPSEvent(),d.hasGPSDone=!0,l.setStatusWithColor("Posizione(mappa)","#279219")}),Titanium.Geolocation.getLocationServicesEnabled()||l.setStatus("Disabilitato!"),Ti.App.addEventListener("report_complete",function(){y.setButtonTitle("Inviato!")}),p.addEventListener("postlayout",function(){f||(setTimeout(function(){d.startGPS()},3e3),f=!0)}),p.add(g),p.add(T),p.add(a),p.add(_),p.add(o),p.add(v),p.add(l),p.add(y),p.add(S),p.add(m),h.add(p),h}module.exports=Report;