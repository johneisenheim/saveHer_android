function Report(){var e=require("external/Listeners"),t=new e,i=require("external/Location"),a=require("ui/handheld/rectangles/ReportRectangle"),o=new a,n=require("ui/handheld/rectangles/NetworkRectangle"),r=new n,s=require("ui/handheld/rectangles/GPSRectangle"),l=new s,c=require("ui/handheld/ui_elements/Buttons"),u=require("ui/handheld/pages/MainPage"),d=new i,f=!1,h=Titanium.UI.createWindow({backgroundColor:"#f8f8f8",width:"100%",height:"100%",title:"Report",windowSoftInputMode:Titanium.UI.Android.SOFT_INPUT_STATE_ALWAYS_HIDDEN,orientationModes:[Titanium.UI.PORTRAIT],exitOnClose:!0});h.activity.onCreateOptionsMenu=function(){h.activity.actionBar},h.addEventListener("androidback",function(){d.removeGPSEvent(),r.removeInterval();var e=new u;e.open(),h.close()}),r.addEventListener("click",function(){"Fatto!"!=r.getButtonStatus()&&t.storeReport(r,o,d,l,h)});var p=Titanium.UI.createScrollView({width:"100%",height:"100%",backgroundColor:"#f6f6f6",layout:"vertical"}),m=Titanium.UI.createLabel({text:"Report",font:{fontSize:40,fontFamily:"CaviarDreams"},color:"#4F5153",top:10}),g=Titanium.UI.createLabel({text:"Crea una nuova segnalazione.",font:{fontSize:20,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:15,width:"95%"}),T=Titanium.UI.createLabel({text:"Se sei in condizioni di scarsa rete, puoi memorizzare la segnalazione effettuando un tap sulla tile sottostante.",font:{fontSize:17,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:25,width:"90%"}),v=Titanium.UI.createLabel({text:"Se sei stanco di attendere il segnale GPS, specifica le tue coordinate manualmente tappando sulla tile qui sotto.",font:{fontSize:17,fontFamily:"CaviarDreams"},color:"#4F5153",textAlign:"center",top:25,width:"90%"}),_=new c;_.setButtonTitle("Invia"),_.setButtonTop(25),_.addEventListener("click",function(){if("Inviato!"!=_.getButtonTitle()&&!saveHer.stopExecution){if(saveHer.stopExecution=!0,o.areImagesEmpty()){{Ti.UI.createAlertDialog({message:"Per inviare un report, per favore inserisci almeno una foto.",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void _.setButtonTitle("Invia")}if(!d.hasGPSDone){{Ti.UI.createAlertDialog({message:"Prima di inviare il report, attendi che le coordinate vengano acquisite!",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void _.setButtonTitle("Invia")}if(!Ti.Network.getOnline()){{Ti.UI.createAlertDialog({message:"Per inviare un report, connetti il tuo dispositivo ad una rete!",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void _.setButtonTitle("Invia")}if(!Titanium.Filesystem.isExternalStoragePresent()){{Ti.UI.createAlertDialog({message:"Ãˆ necessaria una memoria esterna di appoggio per processare i dati prima dell'invio, ma il tuo disposito non sembra esserne munito.",ok:"Ok",title:"saveHer"}).show()}return saveHer.stopExecution=!1,void _.setButtonTitle("Invia")}t.sendReport(_,o,l)}});var w=Titanium.UI.createView({width:1,height:20,backgroundColor:"transparent"});return Ti.App.addEventListener("web_map_pin",function(e){l.setLatLng(e.coords.k,e.coords.B),d.removeGPSEvent(),d.hasGPSDone=!0,l.setStatusWithColor("Posizione(mappa)","#279219")}),Titanium.Geolocation.getLocationServicesEnabled()||l.setStatus("Disabilitato!"),Ti.App.addEventListener("report_complete",function(){_.setButtonTitle("Inviato!")}),p.addEventListener("postlayout",function(){f||(setTimeout(function(){d.startGPS()},1e3),f=!0)}),p.add(m),p.add(g),p.add(o),p.add(T),p.add(r),p.add(v),p.add(l),p.add(_),p.add(w),h.add(p),h}module.exports=Report;